<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Atribui√ß√µes - KB Governance [PRODU√á√ÉO]</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0054C7;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-900: #111827;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--gray-50);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #003d8f 100%);
            color: white;
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 32px;
            box-shadow: 0 10px 30px rgba(0, 84, 199, 0.3);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .badge-prod {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            margin-left: 12px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            border-bottom: 2px solid var(--gray-200);
            overflow-x: auto;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 200ms;
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            gap: 24px;
            margin-bottom: 32px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--gray-100);
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
            transition: transform 200ms;
        }

        .metric-card:hover {
            transform: translateY(-4px);
        }

        .metric-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--gray-900);
        }

        .metric-subtitle {
            font-size: 13px;
            color: var(--gray-600);
            margin-top: 4px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 14px;
            transition: all 200ms;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 84, 199, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .form-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 200ms;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #003d8f 100%);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        .badge-danger {
            background: var(--danger);
            color: white;
        }

        .badge-info {
            background: var(--primary);
            color: white;
        }

        .badge-gray {
            background: var(--gray-200);
            color: var(--gray-600);
        }

        .alert {
            padding: 16px 20px;
            border-radius: 10px;
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .alert-success {
            background: #d1fae5;
            border-left: 4px solid var(--success);
            color: #065f46;
        }

        .alert-warning {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            color: #92400e;
        }

        .alert-danger {
            background: #fee2e2;
            border-left: 4px solid var(--danger);
            color: #991b1b;
        }

        .alert-info {
            background: #dbeafe;
            border-left: 4px solid var(--primary);
            color: #1e40af;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            font-weight: 700;
            color: var(--gray-700);
            background: var(--gray-50);
        }

        tr:hover {
            background: var(--gray-50);
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 20px;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .agent-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            border: 2px solid var(--gray-200);
            transition: all 200ms;
        }

        .agent-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 84, 199, 0.15);
        }

        .agent-name {
            font-weight: 700;
            font-size: 16px;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .agent-username {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 8px;
        }

        .agent-teams {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .agent-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray-600);
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--gray-200);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-pending {
            background: var(--warning);
        }

        .status-in-progress {
            background: var(--primary);
        }

        .status-completed {
            background: var(--success);
        }

        .status-cancelled {
            background: var(--gray-600);
        }

        .api-url {
            font-size: 12px;
            color: var(--gray-600);
            margin-top: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìã Sistema de Atribui√ß√µes <span class="badge-prod">‚úì PRODU√á√ÉO</span></h1>
        <p>Gest√£o de respons√°veis para atualiza√ß√£o de manuais da KB com integra√ß√£o Movidesk</p>
        <div class="api-url">API: <span id="apiUrl">Carregando...</span></div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
        <button class="tab" onclick="showTab('agents')">üë• Agentes</button>
        <button class="tab" onclick="showTab('assign')">‚ûï Nova Atribui√ß√£o</button>
        <button class="tab" onclick="showTab('assignments')">üìã Atribui√ß√µes</button>
    </div>

    <!-- TAB: DASHBOARD -->
    <div id="tab-dashboard" class="tab-content active">
        <div class="grid grid-4" id="dashboardCards">
            <div class="loading"><div class="spinner"></div></div>
        </div>

        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üèÜ Top 5 Agentes</h3>
                    <button class="btn btn-outline" onclick="loadDashboard()">üîÑ Atualizar</button>
                </div>
                <div id="topAgentsList"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">‚è∞ Atribui√ß√µes Atrasadas</h3>
                    <button class="btn btn-outline" onclick="loadOverdue()">üîÑ Atualizar</button>
                </div>
                <div id="overdueList"></div>
            </div>
        </div>
    </div>

    <!-- TAB: AGENTES -->
    <div id="tab-agents" class="tab-content">
        <div class="card" style="margin-bottom: 24px;">
            <div class="card-header">
                <h3 class="card-title">Controles</h3>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-outline" onclick="loadAgents()">
                        üîÑ Recarregar
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-3" id="agentsList">
            <div class="loading"><div class="spinner"></div></div>
        </div>
    </div>

    <!-- TAB: NOVA ATRIBUI√á√ÉO -->
    <div id="tab-assign" class="tab-content">
        <div class="card" style="max-width: 800px; margin: 0 auto;">
            <div class="card-header">
                <h3 class="card-title">‚ûï Nova Atribui√ß√£o Manual</h3>
            </div>

            <form id="assignForm" onsubmit="createAssignment(event)">
                <div class="form-group">
                    <label class="form-label">ID do Artigo *</label>
                    <input type="number" class="form-input" id="articleId" required
                           placeholder="Ex: 12345">
                </div>

                <div class="form-group">
                    <label class="form-label">Selecione o Agente *</label>
                    <select class="form-select" id="agentSelect" required>
                        <option value="">Carregando agentes...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Motivo *</label>
                    <select class="form-select" id="assignReason" required>
                        <option value="QUALITY_LOW">üìâ Score de Qualidade Baixo</option>
                        <option value="CONTENT_EMPTY">üì≠ Conte√∫do Vazio</option>
                        <option value="CONTENT_OUTDATED">üìÖ Conte√∫do Desatualizado</option>
                        <option value="DUPLICATE">üîÑ Duplicado Detectado</option>
                        <option value="NO_STRUCTURE">üìù Sem Estrutura M√≠nima</option>
                        <option value="MANUAL_REQUEST">‚úã Solicita√ß√£o Manual</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Prioridade *</label>
                    <select class="form-select" id="assignPriority" required>
                        <option value="LOW">üü¢ Baixa</option>
                        <option value="MEDIUM" selected>üü° M√©dia</option>
                        <option value="HIGH">üü† Alta</option>
                        <option value="URGENT">üî¥ Urgente</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Prazo (Opcional)</label>
                    <input type="date" class="form-input" id="dueDate">
                </div>

                <div class="form-group">
                    <label class="form-label">Descri√ß√£o Adicional (Opcional)</label>
                    <textarea class="form-textarea" id="assignDescription"
                              placeholder="Informa√ß√µes adicionais sobre o que precisa ser atualizado..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-checkbox">
                        <input type="checkbox" id="createTicket" checked>
                        <span>üé´ Criar ticket automaticamente no Movidesk</span>
                    </label>
                </div>

                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="btn btn-outline" onclick="showTab('assignments')">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Criar Atribui√ß√£o
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- TAB: ATRIBUI√á√ïES -->
    <div id="tab-assignments" class="tab-content">
        <div class="card" style="margin-bottom: 24px;">
            <div class="card-header">
                <h3 class="card-title">Filtros</h3>
                <div style="display: flex; gap: 12px;">
                    <select class="form-select" id="statusFilter" onchange="loadAssignments()"
                            style="width: auto;">
                        <option value="">Todos os Status</option>
                        <option value="PENDING" selected>Pendentes</option>
                        <option value="IN_PROGRESS">Em Andamento</option>
                        <option value="COMPLETED">Conclu√≠das</option>
                        <option value="CANCELLED">Canceladas</option>
                    </select>
                    <button class="btn btn-outline" onclick="loadAssignments()">
                        üîÑ Atualizar
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div id="assignmentsList">
                <div class="loading"><div class="spinner"></div></div>
            </div>
        </div>
    </div>
</div>

<script>
    // ==================== CONFIGURA√á√ÉO ====================
    const API_BASE_URL = window.location.origin;

    document.getElementById('apiUrl').textContent = API_BASE_URL;

    // ==================== UTILITIES ====================
    function formatDate(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        return new Intl.DateTimeFormat('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        }).format(date);
    }

    function formatReason(reason) {
        const map = {
            'QUALITY_LOW': 'Score Baixo',
            'CONTENT_EMPTY': 'Vazio',
            'CONTENT_OUTDATED': 'Desatualizado',
            'DUPLICATE': 'Duplicado',
            'NO_STRUCTURE': 'Sem Estrutura',
            'MANUAL_REQUEST': 'Manual'
        };
        return map[reason] || reason;
    }

    function getPriorityBadge(priority) {
        const map = {
            'LOW': 'gray',
            'MEDIUM': 'info',
            'HIGH': 'warning',
            'URGENT': 'danger'
        };
        return map[priority] || 'gray';
    }

    async function apiCall(endpoint, options = {}) {
        try {
            const response = await fetch(API_BASE_URL + endpoint, {
                ...options,
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            return await response.json();
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }

    // ==================== TAB NAVIGATION ====================
    function showTab(tabName) {
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        document.getElementById(`tab-${tabName}`).classList.add('active');

        if (tabName === 'dashboard') loadDashboard();
        if (tabName === 'agents') loadAgents();
        if (tabName === 'assign') loadAgentSelect();
        if (tabName === 'assignments') loadAssignments();
    }

    // ==================== DASHBOARD ====================
    async function loadDashboard() {
        try {
            const stats = await apiCall('/kb/assignments/statistics');

            document.getElementById('dashboardCards').innerHTML = `
                    <div class="metric-card">
                        <div class="metric-label">Total de Agentes</div>
                        <div class="metric-value">${stats.activeAgents || 0}</div>
                        <div class="metric-subtitle">ativos no sistema</div>
                    </div>
                    <div class="metric-card" style="border-left-color: var(--warning);">
                        <div class="metric-label">Pendentes</div>
                        <div class="metric-value">${stats.pending || 0}</div>
                        <div class="metric-subtitle">aguardando in√≠cio</div>
                    </div>
                    <div class="metric-card" style="border-left-color: var(--primary);">
                        <div class="metric-label">Em Andamento</div>
                        <div class="metric-value">${stats.inProgress || 0}</div>
                        <div class="metric-subtitle">sendo atualizados</div>
                    </div>
                    <div class="metric-card" style="border-left-color: var(--success);">
                        <div class="metric-label">Conclu√≠das</div>
                        <div class="metric-value">${stats.completed || 0}</div>
                        <div class="metric-subtitle">finalizadas</div>
                    </div>
                `;

            await loadTopAgents();
            await loadOverdue();

        } catch (error) {
            document.getElementById('dashboardCards').innerHTML = `
                    <div class="alert alert-danger" style="grid-column: 1/-1;">
                        <strong>Erro ao carregar dashboard:</strong> ${error.message}
                    </div>
                `;
        }
    }

    async function loadTopAgents() {
        try {
            const agents = await apiCall('/kb/agents/top/5');

            if (agents.length === 0) {
                document.getElementById('topAgentsList').innerHTML =
                    '<div class="alert alert-info">Nenhum agente com conclus√µes ainda.</div>';
                return;
            }

            document.getElementById('topAgentsList').innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Agente</th>
                                <th>Conclu√≠das</th>
                                <th>Pendentes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${agents.map(a => `
                                <tr>
                                    <td><strong>${a.businessName}</strong></td>
                                    <td><span class="badge badge-success">${a.completedCount || 0}</span></td>
                                    <td><span class="badge badge-warning">${a.assignedCount || 0}</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

        } catch (error) {
            document.getElementById('topAgentsList').innerHTML =
                `<div class="alert alert-danger">Erro: ${error.message}</div>`;
        }
    }

    async function loadOverdue() {
        try {
            const overdue = await apiCall('/kb/assignments/overdue');

            if (overdue.length === 0) {
                document.getElementById('overdueList').innerHTML =
                    '<div class="alert alert-success">‚úÖ Nenhuma atribui√ß√£o atrasada!</div>';
                return;
            }

            document.getElementById('overdueList').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>‚ö†Ô∏è ${overdue.length} atribui√ß√µes atrasadas</strong>
                    </div>
                    ${overdue.map(a => `
                        <div style="padding: 12px; border-left: 4px solid var(--danger); background: var(--gray-50); border-radius: 8px; margin-bottom: 8px;">
                            <div style="font-weight: 600;">Artigo #${a.articleId}</div>
                            <div style="font-size: 13px; color: var(--gray-600);">
                                Respons√°vel: ${a.agent?.businessName || 'N/A'}<br>
                                Prazo: ${formatDate(a.dueDate)}
                                ${a.ticketId ? `<br>Ticket: <a href="${a.ticketUrl}" target="_blank">${a.ticketId}</a>` : ''}
                            </div>
                        </div>
                    `).join('')}
                `;

        } catch (error) {
            document.getElementById('overdueList').innerHTML =
                `<div class="alert alert-danger">Erro: ${error.message}</div>`;
        }
    }

    // ==================== AGENTS ====================
    async function loadAgents() {
        try {
            const agents = await apiCall('/kb/agents');

            document.getElementById('agentsList').innerHTML = agents.map(agent => `
                    <div class="agent-card">
                        <div class="agent-name">${agent.businessName}</div>
                        <div class="agent-username">@${agent.userName}</div>
                        ${agent.teams && agent.teams.length > 0 ? `
                            <div class="agent-teams">
                                ${agent.teams.map(t => `<span class="badge badge-info">${t}</span>`).join('')}
                            </div>
                        ` : ''}
                        ${agent.specialties && agent.specialties.length > 0 ? `
                            <div class="agent-teams" style="margin-top: 4px;">
                                ${agent.specialties.map(s => `<span class="badge badge-gray">${s}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="agent-stats">
                            <span>‚úÖ ${agent.completedCount || 0} conclu√≠das</span>
                            <span>‚è≥ ${agent.assignedCount || 0} pendentes</span>
                        </div>
                    </div>
                `).join('');

        } catch (error) {
            document.getElementById('agentsList').innerHTML =
                `<div class="alert alert-danger">Erro ao carregar agentes: ${error.message}</div>`;
        }
    }

    async function loadAgentSelect() {
        try {
            const agents = await apiCall('/kb/agents');

            const select = document.getElementById('agentSelect');
            select.innerHTML = '<option value="">Selecione um agente...</option>' +
                agents.map(a => `
                        <option value="${a.id}">
                            ${a.businessName} (${a.assignedCount || 0} pendentes)
                        </option>
                    `).join('');

        } catch (error) {
            console.error('Erro ao carregar agentes:', error);
        }
    }

    // ==================== CREATE ASSIGNMENT ====================
    async function createAssignment(event) {
        event.preventDefault();

        const dueDateValue = document.getElementById('dueDate').value;
        const dueDate = dueDateValue ? new Date(dueDateValue).toISOString() : null;

        const data = {
            articleId: parseInt(document.getElementById('articleId').value),
            agentId: document.getElementById('agentSelect').value,
            reason: document.getElementById('assignReason').value,
            priority: document.getElementById('assignPriority').value,
            dueDate: dueDate,
            description: document.getElementById('assignDescription').value,
            createTicket: document.getElementById('createTicket').checked
        };

        try {
            const result = await apiCall('/kb/assignments/manual', {
                method: 'POST',
                body: JSON.stringify(data)
            });

            alert(`‚úÖ Atribui√ß√£o criada com sucesso!\n\n` +
                `üìã ID: ${result.id}\n` +
                `üë§ Respons√°vel: ${result.agent?.businessName || 'N/A'}\n` +
                `üìÑ Artigo: ${result.articleId}\n` +
                (result.ticketId ? `üé´ Ticket Movidesk: ${result.ticketId}` : '‚ö†Ô∏è Ticket n√£o criado'));

            document.getElementById('assignForm').reset();
            showTab('assignments');

        } catch (error) {
            alert('‚ùå Erro ao criar atribui√ß√£o:\n' + error.message);
        }
    }

    // ==================== ASSIGNMENTS ====================
    async function loadAssignments() {
        try {
            const statusFilter = document.getElementById('statusFilter').value;
            const endpoint = statusFilter
                ? `/kb/assignments?status=${statusFilter}`
                : '/kb/assignments';

            const assignments = await apiCall(endpoint);

            if (assignments.length === 0) {
                document.getElementById('assignmentsList').innerHTML =
                    '<div class="alert alert-info">Nenhuma atribui√ß√£o encontrada.</div>';
                return;
            }

            document.getElementById('assignmentsList').innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Artigo</th>
                                <th>Respons√°vel</th>
                                <th>Motivo</th>
                                <th>Prioridade</th>
                                <th>Status</th>
                                <th>Ticket</th>
                                <th>Criado</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${assignments.map(a => `
                                <tr>
                                    <td><strong>#${a.id}</strong></td>
                                    <td>${a.articleId}</td>
                                    <td>${a.agent?.businessName || 'N/A'}</td>
                                    <td><span class="badge badge-gray">${formatReason(a.reason)}</span></td>
                                    <td><span class="badge badge-${getPriorityBadge(a.priority)}">${a.priority}</span></td>
                                    <td>
                                        <span class="status-indicator status-${a.status.toLowerCase().replace('_', '-')}"></span>
                                        ${a.status}
                                    </td>
                                    <td>
                                        ${a.ticketId ? `<a href="${a.ticketUrl}" target="_blank">${a.ticketId}</a>` : '-'}
                                    </td>
                                    <td>${formatDate(a.createdAt)}</td>
                                    <td>
                                        ${a.status === 'PENDING' ? `
                                            <button class="btn btn-success" style="font-size: 11px; padding: 4px 8px;" onclick="completeAssignment(${a.id})">
                                                ‚úì Concluir
                                            </button>
                                        ` : '-'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

        } catch (error) {
            document.getElementById('assignmentsList').innerHTML =
                `<div class="alert alert-danger">Erro ao carregar atribui√ß√µes: ${error.message}</div>`;
        }
    }

    async function completeAssignment(id) {
        const note = prompt('Nota de conclus√£o (opcional):');

        try {
            await apiCall(`/kb/assignments/${id}/complete`, {
                method: 'POST',
                body: JSON.stringify({ completionNote: note })
            });

            alert('‚úÖ Atribui√ß√£o marcada como conclu√≠da!');
            loadAssignments();
            loadDashboard();

        } catch (error) {
            alert('‚ùå Erro ao concluir atribui√ß√£o:\n' + error.message);
        }
    }

    // ==================== INIT ====================
    document.addEventListener('DOMContentLoaded', () => {
        loadDashboard();
    });
</script>
</body>
</html>